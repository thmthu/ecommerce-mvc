<%- include('./partials/header') %>
<%- include('./partials/topbar', {page: 'register'}) %>
    <!-- Navbar Start -->
    <div class="container-fluid">
      <div class="row border-top px-xl-5">
        <div class="col-lg-3 d-none d-lg-block">
          <a
            class="btn shadow-none d-flex align-items-center justify-content-between bg-primary text-white w-100"
            data-toggle="collapse"
            href="#navbar-vertical"
            style="height: 65px; margin-top: -1px; padding: 0 30px"
          >
            <h6 class="m-0">Categories</h6>
            <i class="fa fa-angle-down text-dark"></i>
          </a>
          <nav
            class="collapse position-absolute navbar navbar-vertical navbar-light align-items-start p-0 border border-top-0 border-bottom-0 bg-light"
            id="navbar-vertical"
            style="width: calc(100% - 30px); z-index: 1"
          >
            <div class="navbar-nav w-100 overflow-hidden" style="height: 410px">
              <div class="nav-item dropdown">
                <a href="#" class="nav-link" data-toggle="dropdown"
                  >Dresses <i class="fa fa-angle-down float-right mt-1"></i
                ></a>
                <div
                  class="dropdown-menu position-absolute bg-secondary border-0 rounded-0 w-100 m-0"
                >
                  <a href="" class="dropdown-item">Men's Dresses</a>
                  <a href="" class="dropdown-item">Women's Dresses</a>
                  <a href="" class="dropdown-item">Baby's Dresses</a>
                </div>
              </div>
              <a href="" class="nav-item nav-link">Shirts</a>
              <a href="" class="nav-item nav-link">Jeans</a>
              <a href="" class="nav-item nav-link">Swimwear</a>
              <a href="" class="nav-item nav-link">Sleepwear</a>
              <a href="" class="nav-item nav-link">Sportswear</a>
              <a href="" class="nav-item nav-link">Jumpsuits</a>
              <a href="" class="nav-item nav-link">Blazers</a>
              <a href="" class="nav-item nav-link">Jackets</a>
              <a href="" class="nav-item nav-link">Shoes</a>
            </div>
          </nav>
        </div>
        <div class="col-lg-9">
          <nav
            class="navbar navbar-expand-lg bg-light navbar-light py-3 py-lg-0 px-0"
          >
            <a href="" class="text-decoration-none d-block d-lg-none">
              <h1 class="m-0 display-5 font-weight-semi-bold">
                <span class="text-primary font-weight-bold border px-3 mr-1"
                  >E</span
                >Shopper
              </h1>
            </a>
            <button
              type="button"
              class="navbar-toggler"
              data-toggle="collapse"
              data-target="#navbarCollapse"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div
              class="collapse navbar-collapse justify-content-between"
              id="navbarCollapse"
            >
              <div class="navbar-nav mr-auto py-0">
                <a href="./home" class="nav-item nav-link">Home</a>
                <a href="./shop" class="nav-item nav-link">Shop</a>
                <div class="nav-item dropdown">
                  <a
                    href="#"
                    class="nav-link dropdown-toggle"
                    data-toggle="dropdown"
                    >Pages</a
                  >
                  <div class="dropdown-menu rounded-0 m-0">
                    <a href="./cart" class="dropdown-item">Shopping Cart</a>
                    <a href="./checkout" class="dropdown-item">Checkout</a>
                  </div>
                </div>
                <a href="./contact" class="nav-item nav-link">Contact</a>
              </div>
              <div class="navbar-nav ml-auto py-0">
                <% if (typeof isAuthenticated !== 'undefined') { %>
                  <% if (isAuthenticated) { %>
                  <form id="logout-form" action="/logout" method="POST" style="display: inline;">
                    <input type="hidden" name="_csrf"> <!-- Include CSRF token if needed -->
                    <button type="submit" class="nav-item nav-link btn btn-link" style="padding: 0; border: none; background: none;">Logout</button>
                  </form>
                  <% } else { %>
                    <a href="./login" class="nav-item nav-link">Login</a>
                    <a href="./register" class="nav-item nav-link">Register</a>
                  <% } %>
                <% } else { %>
                  <a href="./login" class="nav-item nav-link">Login</a>
                  <a href="./register" class="nav-item nav-link">Register</a>
                <% } %>
              </div>
            </div>
          </nav>
        </div>
      </div>
    </div>
    <!-- Navbar End -->

    <main>
      <div class="container">
        <section
          class="section register min-vh-100 d-flex flex-column align-items-center justify-content-center py-4"
        >
          <div class="container">
            <div class="row justify-content-center">
              <div
                class="col-lg-4 col-md-6 d-flex flex-column align-items-center justify-content-center"
              >
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="pt-4 pb-2">
                      <h5 class="card-title text-center pb-0 fs-4">
                        Create an Account
                      </h5>
                      <p class="text-center small">
                        Enter your personal details to create account
                      </p>
                    </div>

                    <form
                      action="/register"
                      method="POST"
                      id="registerForm"
                      class="row g-3"
                      novalidate
                    >
                      <!-- Form fields -->
                      <div class="col-12">
                        <label for="yourUsername" class="form-label">Username</label>
                        <div class="input-group">
                          <span class="input-group-text" id="inputGroupPrepend">@</span>
                          <input
                            type="text" 
                            name="username"
                            class="form-control"
                            id="yourUsername"
                            required
                          />
                        </div>
                      </div>

                      <div class="col-12">
                        <label for="yourEmail" class="form-label">Your Email</label>
                        <input
                          type="email"
                          name="email"
                          class="form-control"
                          id="yourEmail"
                          required
                        />
                      </div>

                      <div class="col-12">
                        <label for="yourPassword" class="form-label">Password</label>
                        <input
                          type="password"
                          name="password"
                          class="form-control"
                          id="yourPassword"
                          required
                        />
                      </div>

                      <div class="col-12">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            name="terms"
                            type="checkbox"
                            value="true"
                            id="acceptTerms"
                            required
                          />
                          <label class="form-check-label" for="acceptTerms">
                            I agree and accept the <a href="#">terms and conditions</a>
                          </label>
                        </div>
                      </div>
                      <div class="col-12">
                        <button type="submit" class="btn btn-primary w-100">Create Account</button>
                      </div>
                      <% if (typeof error !== 'undefined') { %>
                        <div class="col-12">
                          <div class="alert alert-danger mt-2">
                            <% if (Array.isArray(error)) { %>
                              <ul>
                                <% error.forEach(error1 => { %>
                                  <li><%= error1 %></li>
                                <% }) %>
                              </ul>
                            <% } else { %>
                              <p><%= error %></p>
                            <% } %>
                          </div>
                        </div>
                      <% } %>
                    </form>
                  </div>
                </div>

                <div class="credits">
                  <!-- All the links in the footer should remain intact. -->
                  <!-- You can delete the links only if you purchased the pro version. -->
                  <!-- Licensing information: https://bootstrapmade.com/license/ -->
                  <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/ -->
                  Designed by
                  <a href="https://bootstrapmade.com/">BootstrapMade</a>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
    <!-- End #main -->

    <a
      href="#"
      class="back-to-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>

    <!-- Vendor JS Files -->
    <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/chart.js/chart.umd.js"></script>
    <script src="assets/vendor/echarts/echarts.min.js"></script>
    <script src="assets/vendor/quill/quill.js"></script>
    <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
    <script src="assets/vendor/tinymce/tinymce.min.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>

    <!-- Template Main JS File -->
    <script src="assets/js/main.js"></script>

    <!-- Custom JS for handling form validation -->
    <script>
      document.getElementById('registerForm').addEventListener('submit', function(event) {
        const form = event.target;
        const password = form.password.value;
        const email = form.email.value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        // Remove existing error messages
        const existingErrors = form.querySelectorAll('.alert-danger');
        existingErrors.forEach(error => error.remove());

        if (password.length < 8) {
          event.preventDefault();
          const errorDiv = document.createElement('div');
          errorDiv.className = 'alert alert-danger mt-2';
          errorDiv.innerText = 'Password must be at least 8 characters long';
          form.appendChild(errorDiv);
        }

        if (!emailRegex.test(email)) {
          event.preventDefault();
          const errorDiv = document.createElement('div');
          errorDiv.className = 'alert alert-danger mt-2';
          errorDiv.innerText = 'Invalid email format';
          form.appendChild(errorDiv);
        }
      });
    </script>
  </body>
</html>